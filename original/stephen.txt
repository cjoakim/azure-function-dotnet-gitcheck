#r "Newtonsoft.Json"
using System;
using Newtonsoft.Json;
private static HttpClient httpClient = new HttpClient();
public static async Task Run(TimerInfo healthCheckTimer, HealthStatus healthStatus, ILogger log)
{
 log.LogInformation($"C# Timer trigger function executed at: {DateTime.Now}");
 log.LogInformation($"Region : {healthStatus.Region}, Status: {healthStatus.Status}");
 var response = await httpClient.GetAsync("https://inruletodo3.azurewebsites.net/health");
 string trafficManagerJson = await response.Content.ReadAsStringAsync();
 
 log.LogInformation(trafficManagerJson as string);
 TrafficManagerStatus trafficManagerResponse = JsonConvert.DeserializeObject<TrafficManagerStatus>(trafficManagerJson);
 //string status = trafficManagerResponse ?? trafficManagerResponse?.status;
 log.LogInformation(trafficManagerResponse.status);
 //log.LogInformation($"TMRegion : {trafficManagerResponse.region}, TMStatus: {trafficManagerResponse.status}");
}
public class HealthStatus
{
 public string PartitionKey { get; set; }
 public string RowKey { get; set; }
 public string Region { get; set; }
 public string Status { get; set; }
}
public class TrafficManagerStatus
{
 public string status { get; }
 public string region { get; }
}

{
 "bindings": [
 {
 "name": "healthCheckTimer",
 "type": "timerTrigger",
 "direction": "in",
 "schedule": "0 */1 * * * *"
 },
 {
 "type": "table",
 "name": "healthStatus",
 "tableName": "healthStatus",
 "take": 1,
 "connection": "AzureWebJobsStorage",
 "direction": "in",
 "partitionKey": "Primary",
 "rowKey": "Region"
 }
 ]
}